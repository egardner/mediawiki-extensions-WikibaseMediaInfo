@import 'mediawiki.mixins';
@import '../mediainfo-variables.less';

// OOUI's indexlayout is JS-only, so I'm inserting links as tabs
// to make it work without JS; I don't want them styles as links,
// though... just the parent's tab styles please!
// stylelint-disable-next-line selector-class-pattern
.wbmi-special-search--tabs .oo-ui-menuLayout-menu a {
	color: inherit;
	text-decoration: inherit;
}

// stylelint-disable-next-line selector-class-pattern
.wbmi-special-search--tabs .oo-ui-indexLayout-stackLayout > .oo-ui-panelLayout {
	padding: 0;
}

// to reach a visually pleasing grid, with consistent-ish margins,
// images will need to (be cropped to) very similar dimensions
// 1. most common aspect ratios are 4:3, 3:2 and 16:9, with 3:2
//    being the middle ground there (4:3 is narrower, 16:9 wider)
// 2. for portrait and landscape images to have the same height,
//    landscape images will be 2.25 times as wide as portrait images,
//    assuming a 3:2 aspect ratio (landscape: 180 height, 270 width;
//    portrait: 180 height, 120 width)
// 3. there are about twice as many landscape images on commons
//    as there are portrait images; so for every 3 images, 2 will
//    be landscape (width: 3, height: 2) and 1 will be portrait
//    (width: 2, height: 3)
// 4: the perfect average row (of 6 thumbs) would have these widths
//    (relative to one another): 3 - 3 - 1.33 - 3 - 3 - 1.33, or an average
//    for any fixed height (`H`), the average width will be:
//    H / 2 * (2 * landscape-width + 1 * portrait-width) / 3
//    = H / 2 * (2 * 3 + 1 * (2 / 3 * 2)) / 3
@average-aspect-ratio: 3 / 2; // width / height
@landscape-portrait-ratio: 2 / 1; // landscape / portrait
@thumb-height: 180px;
@thumb-width: ( ( @landscape-portrait-ratio * @thumb-height * @average-aspect-ratio ) + ( 1 * @thumb-height / @average-aspect-ratio ) ) / ( @landscape-portrait-ratio + 1 );

.wbmi-special-search--bitmap,
.wbmi-special-search--audio,
.wbmi-special-search--video,
.wbmi-special-search--category {
	width: 100%;
	padding: @base-spacing 0;
}

.wbmi-special-search--bitmap {
	.flex-display();
	.flex-wrap( wrap );
	justify-content: space-between;
	align-items: center;
}

.wbmi-special-search--result-bitmap {
	margin: @sm-spacing @xs-spacing;
	text-align: center;

	// @thumb-width is the average width of a thumbnail, but we don't want
	// to enforce that width: we'll allow the exact image width up to a
	// certain minimum/maximum
	// we'll use media queries to approximate the available space & adjust
	// min/max sizes of our thumbnails accordingly - the minimum & maximum
	// boundaries grow larger as we can display more images, because more
	// images means they'll even out one another more
	min-width: ~'calc( -2 * @{xs-spacing} + min( @{thumb-width}, 0.9 * 100% ) )';
	max-width: ~'calc( -2 * @{xs-spacing} + max( @{thumb-width}, 1 * 100% ) )';

	@media ( min-width: calc( 1.9 * @thumb-width + 200px ) ) {
		min-width: ~'calc( -2 * @{xs-spacing} + min( @{thumb-width}, 0.875 * calc( 100% / 2 ) ) )';
		max-width: ~'calc( -2 * @{xs-spacing} + max( @{thumb-width}, 1.025 * calc( 100% / 2 ) ) )';
	}

	@media ( min-width: calc( 2.85 * @thumb-width + 200px ) ) {
		min-width: ~'calc( -2 * @{xs-spacing} + min( @{thumb-width}, 0.85 * calc( 100% / 3 ) ) )';
		max-width: ~'calc( -2 * @{xs-spacing} + max( @{thumb-width}, 1.05 * calc( 100% / 3 ) ) )';
	}

	@media ( min-width: calc( 3.8 * @thumb-width + 200px ) ) {
		min-width: ~'calc( -2 * @{xs-spacing} + min( @{thumb-width}, 0.825 * calc( 100% / 4 ) ) )';
		max-width: ~'calc( -2 * @{xs-spacing} + max( @{thumb-width}, 1.075 * calc( 100% / 4 ) ) )';
	}

	@media ( min-width: calc( 4.75 * @thumb-width + 200px ) ) {
		min-width: ~'calc( -2 * @{xs-spacing} + min( @{thumb-width}, 0.8 * calc( 100% / 5 ) ) )';
		max-width: ~'calc( -2 * @{xs-spacing} + max( @{thumb-width}, 1.1 * calc( 100% / 5 ) ) )';
	}

	@media ( min-width: calc( 5.7 * @thumb-width + 200px ) ) {
		min-width: ~'calc( -2 * @{xs-spacing} + min( @{thumb-width}, 0.775 * calc( 100% / 6 ) ) )';
		max-width: ~'calc( -2 * @{xs-spacing} + max( @{thumb-width}, 1.125 * calc( 100% / 6 ) ) )';
	}

	@media ( min-width: calc( 6.65 * @thumb-width + 200px ) ) {
		min-width: ~'calc( -2 * @{xs-spacing} + min( @{thumb-width}, 0.75 * calc( 100% / 7 ) ) )';
		max-width: ~'calc( -2 * @{xs-spacing} + max( @{thumb-width}, 1.15 * calc( 100% / 7 ) ) )';
	}

	@media ( min-width: calc( 7.6 * @thumb-width + 200px ) ) {
		min-width: ~'calc( -2 * @{xs-spacing} + min( @{thumb-width}, 0.725 * calc( 100% / 8 ) ) )';
		max-width: ~'calc( -2 * @{xs-spacing} + max( @{thumb-width}, 1.175 * calc( 100% / 8 ) ) )';
	}

	@media ( min-width: calc( 8.55 * @thumb-width + 200px ) ) {
		min-width: ~'calc( -2 * @{xs-spacing} + min( @{thumb-width}, 0.7 * calc( 100% / 9 ) ) )';
		max-width: ~'calc( -2 * @{xs-spacing} + max( @{thumb-width}, 1.2 * calc( 100% / 9 ) ) )';
	}

	@media ( min-width: calc( 9.5 * @thumb-width + 200px ) ) {
		min-width: ~'calc( -2 * @{xs-spacing} + min( @{thumb-width}, 0.625 * calc( 100% / 10 ) ) )';
		max-width: ~'calc( -2 * @{xs-spacing} + max( @{thumb-width}, 1.225 * calc( 100% / 10 ) ) )';
	}
}

.wbmi-special-search--thumbnail {
	// if images exceed acceptable width, don't distort the
	// image, simply cover the available space
	max-width: 100%;
	max-height: 100%;
	object-fit: cover;
	// we specifically ask for 170px thumbs already, so this should not
	// be necessary, but the audio placeholders seem to be 400px
	// regardless of the requested thumbnail size
	height: @thumb-height;
	width: 100%;
}

.wbmi-special-search--result-bitmap:hover {
	.wbmi-special-search--thumbnail {
		.box-shadow( 4px 4px 5px -2px @base50 );
	}
}

.wbmi-special-search--result-audio,
.wbmi-special-search--result-video,
.wbmi-special-search--result-category {
	&:nth-child( odd ) {
		background-color: @odd-color;
	}

	audio,
	video {
		display: block;
		max-width: 200px;
	}
}

.wbmi-special-search--result-audio td,
.wbmi-special-search--result-category td {
	padding: @base-spacing;
}

.wbmi-special-search--result-video td {
	padding: @sm-spacing @base-spacing;
}

.wbmi-special-search--thumb {
	text-align: center;
}

.wbmi-special-search--text {
	width: 100%;

	p {
		margin: initial;
	}
}

.wbmi-special-search--title {
	font-size: @large-font-size;
	font-weight: bold;
}

.wbmi-special-search--notice {
	display: inline-block;
	padding: @base-spacing;
	margin: @base-spacing 0;
	border: @base-border;
	border-color: @yellow50;
	background: @yellow90;
}

.wbmi-special-search--continue {
	text-align: center;
}
